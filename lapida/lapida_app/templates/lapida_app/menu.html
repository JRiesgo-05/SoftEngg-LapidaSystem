{% extends "lapida_app/base.html" %}
{% load static %}
{% block content  %}
{% load bootstrap4 %}
{% bootstrap_css %}
{% bootstrap_javascript jquery='full' %}
{{order.media}}
{% load define_action %}
<!-- Demo header-->
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha384-nvAa0+6Qg9clwYCGGPpDQLVpLNn0fRaROjHqs13t4Ggj3Ez50XnGQqc/r8MhnRDZ"
            crossorigin="anonymous">
    </script>
    <script src="jquery.nice-number.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="{% static 'lapida_app/menu/menu.css' %}" rel="stylesheet">
    <link href="{% static 'lapida_app/menu/css/gijgo.min.css' %}" rel="stylesheet">
    <link href="jquery.nice-number.css" rel="stylesheet">


</head>
<section class="py-5 header text-center text-white">
    <div class="container pt-4">
        <header>
            <h1 class="display-4">HAVEN'S MEMORY SERVICES</h1>
            <h6 class="font-italic mb-1">Select the services that you would like to avail for your loved one.</h6>
        </header>
    </div>
</section>


<section>
    <div class="container">
        <div class="row">
            <div class="col-lg-7 mx-auto">
                
                <div class="card shadow border-0 mb-5">
                    <div class="card-body p-5">
                        <h2 class="h4 mb-1">Choose Beneficiary</h2>
                        <p class="small text-muted font-italic mb-4">Select a registered loved one.</p>
                        <form method="POST" action="">
                  <select class="form-select" name="uid" aria-label="Default select example" required>
                  <option selected disabled value ="">Select a Loved One</option>
                  {% with cemetery=""%}
                  {%for item in form%}
                  <option value="{{item.uid}}" {% if item.uid == uid %} cemetery=item.place selected{% endif %}>{{item.last_name}}, {{item.first_name}} {{item.middle_name}}</option>
                  {%endfor%}
                </select>
                    </div>
                </div>
                <div class="card shadow border-0 mb-5">
                    <div class="card-body p-5">
                                   <p> {{cemetery}} </p>
                                          {%endwith%}
<!--                          {%for place in cemeteries%}
                         <p> {{place}} </p>
                         {%endfor%} -->
                        <h2 class="h4 mb-1">Pick a Service</h2>
                        <p class="small text-muted font-italic mb-4">You can pick any number of services to avail.</p>
                            {% csrf_token %}
                        <ul class="list-group mx-auto">
                            <li class="list-group-item">
                                <div class="custom-control custom-checkbox">
                                    <input class="custom-control-input" id="graveCheck" type="checkbox" name="graveCheck">
                                    <label class="cursor-pointer font-italic d-block custom-control-label" for="graveCheck"><p class="mb-0">Gravesite Care</p><span class="small font-italic text-muted">Includes gravestone and landscape care for the refurbishment of your loved one's resting place.</span>
                                    </label>
                                 <label for="graveCheck"><img src="https://images-ext-1.discordapp.net/external/3Qi2hGT4nYHrRLZDNC-dKjDQ6wgcSdPH2PNyVYG8p_s/http/rose-rock.com/wp-content/uploads/cleaning-a-headstone.jpg" alt="" width="180"></label>
                                </div>
                            </li>
                            <li class="list-group-item">
                                <div class="custom-control custom-checkbox">
                                    <input class="custom-control-input" id="flowerCheck" type="checkbox" name="flowerCheck">
                                    <label class="cursor-pointer font-italic d-block custom-control-label" for="flowerCheck"><p class="mb-0">Floral Arrangements</p><span class="small font-italic text-muted">Placement of artificial flower arrangements. Includes standard bouquets & materials. Price varies.</span>
                                    </label>
                                 <label for="flowerCheck"><img src="https://images-ext-1.discordapp.net/external/dbeLxEtcPs2Kf_VsEaTtBWMpJayuX2cttqSNtWMSVKc/https/asset.bloomnation.com/c_pad%2Cd_vendor%3Aglobal%3Acatalog%3Aproduct%3Aimage.png%2Cf_auto%2Cfl_preserve_transparency%2Cq_auto/v1605627801/vendor/6548/catalog/product/2/0/20181123113031_file_5bf88d973d7d6.jpg?width=697&height=675" alt="" width="180"></label>
                                </div>
                            </li>
                            <!-- <li class="list-group-item">
                                <div class="custom-control custom-checkbox">
                                    <input class="custom-control-input" id="candleCheck" type="checkbox" name="candleCheck">
                                    <label class="cursor-pointer font-italic d-block custom-control-label" for="candleCheck"><p class="mb-0">Candle Lights - ₱500</p><span class="small font-italic text-muted">Light candles to your loved one for their guidance.</span>
                                    </label>
                                 <label for="candleCheck"><img src="https://media.discordapp.net/attachments/802135528907472896/816961878198321162/candle.jpg" alt="" width="180"></label>
                                </div>
                            </li> -->
                            <li class="list-group-item">
                                <div class="custom-control custom-checkbox">
                                    <input class="custom-control-input" id="prayerCheck" type="checkbox" name="prayerCheck" prayerPrice="1500">
                                    <label class="cursor-pointer font-italic d-block custom-control-label" for="prayerCheck"><p class="mb-0">Prayer Service and Candle Lighting - ₱1500</p><span class="small font-italic text-muted">This service provides a personal prayer for your loved one, as well as lighting candles to dedicate to their memory.</span>
                                    </label>
                                 <label for="prayerCheck"><img src="../../static/lapida_app/menu/images/prayerimg.png" alt="" width="180"></label>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>

                <div id="gravecard" class="checkout">
                    <div class="card shadow border-0 mb-5">
                        <div class="card-body p-5">
                            <h2 class="h4 mb-1">Choose the Services for the Gravesite Care</h2>
                            <ul class="list-group">
                                <li class="list-group-item rounded-0 d-flex align-items-center justify-content-between">
                                    <div class="custom-control custom-checkbox">
                                        <input class="custom-control-input" id="gravecareCheck" type="checkbox" name="gravecareCheck" graveprice="1000" value="Gravestone Care - ₱1000" checked>
                                        <label class="custom-control-label" for="gravecareCheck">
                                            <p class="mb-0">Gravestone Care - ₱1000</p><span class="small font-italic text-muted">Cleansing of dirt and other artifacts alongside the re-establishing of the gravestone foundation.</span>
                                        </label>
                                    </div>
                                    <label for="gravecareCheck"><img src="../../static/lapida_app/menu/images/grave1.jpg" alt="" width="60"></label>
                                </li>
                                <li class="list-group-item d-flex align-items-center justify-content-between">
                                    <div class="custom-control custom-checkbox">
                                        <input class="custom-control-input" id="landscapeCheck" name="landscapeCheck" type="checkbox" graveprice="1000" value="Landscape Care - ₱1000" checked>
                                        <label class="custom-control-label" for="landscapeCheck">
                                            <p class="mb-0">Landscape Care - ₱1000</p><span class="small font-italic text-muted">Extensive maintenance of the land surrounding the gravestone.</span>
                                        </label>
                                    </div>
                                    <label for="landscapeCheck"><img src="../../static/lapida_app/menu/images/grave2.jpg" alt="" width="60"></label>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="flowercard" class="checkout">
                    <div class="card shadow border-0 mb-5">
                        <div class="card-body p-5">
                            <h2 class="h4 mb-1">Choose the Flower Shop</h2>
                            <select class="form-select" name="flowerSelect" id="flowerSelect" aria-label="Default select example" required>
                                <option selected disabled value="default">Select among the choices</option>
                                <option value="citifora">Citifora Flowers</option>
                                <option value="gertudes">Gertudes Flowershop</option>
                                <option value="raphael">Raphael's Gifts</option>
                                <option value="larose">La Rose</option>
                            </select>
                            </br>
                            <h2 class="h4 mb-1" id="arrangementtext">Choose the Type of Flower Arrangement</h2>
                            <div name="citiforagroup" id="citiforagroup">
                                <ul class="list-group">
                                   {%for flower in flowers.CF%}
                                    {{flower|safe}}
                                   {%endfor -%}
                                </ul>
                            </div>
                            <ul class="list-group" name="gertudesgroup" id="gertudesgroup">
                                {%for flower in flowers.GF%}
                                {{flower|safe}}
                               {%endfor -%}
                            </ul>
                            <ul class="list-group" name="raphaelgroup" id="raphaelgroup">
                                {%for flower in flowers.RG%}
                                {{flower|safe}}
                               {%endfor -%}
                            </ul>
                            <ul class="list-group" name="larosegroup" id="larosegroup">
                                {%for flower in flowers.LR%}
                                {{flower|safe}}
                               {%endfor -%}
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="datepickercard" class="checkout">
                    <div class="card shadow border-0 mb-5">
                        <div class="card-body p-5">
                            <h2 class="h4 mb-1">Select the Date of Service</h2>
                            <p class="small text-muted font-italic mb-4">Please choose the date on when to avail the selected service/s.</p>
                            {{order.order_date}}
                        </div>
                    </div>
                </div>

                <div id="notecard" class="checkout">
                    <div class="card shadow border-0 mb-5">
                        <div class="card-body p-5">
                            <h2 class="h4 mb-1">Additional Notes</h2>
                            <p class="small text-muted font-italic mb-4">Write out specific instructions or additional messages to the caretaker in charge of the service/s. (Optional)</p>
                            <textarea class="form-control" name="Note" id="textarea" rows="3"></textarea>
                        </div>
                    </div>
                </div>

                {% comment %} <div id="candlecard" class="checkout">
                    <div class="card shadow border-0 mb-5">
                        <div class="card-body p-5">
                            <h2 class="h4 mb-1">Customize your Candle Options</h2>
                            <ul class="list-group mx-auto">
                                <li class="list-group-item d-flex align-items-center justify-content-between">
                                    <div class="custom-control">
                                        <label>
                                            <p class="mb-0">Candle Type 1</p><span class="small font-italic text-muted">Desc 1</span>
                                        </label>
                                        <div style="width: 125px">
                                            <input id="candle1" type="number" value="0" min="0" max="10"/>
                                        </div>
                                    </div>
                                    <label for="citiforaRadio3"><img src="../../static/lapida_app/menu/images/candle1.png" alt="" width="60"></label>
                                </li>
                                <li class="list-group-item d-flex align-items-center justify-content-between">
                                    <div class="custom-control">
                                        <label>
                                            <p class="mb-0">Candle Type 2</p><span class="small font-italic text-muted">Desc 2</span>
                                        </label>
                                        <div style="width: 125px">
                                            <input id="candle2" type="number" value="0" min="0" max="10"/>
                                        </div>
                                    </div>
                                    <label for="citiforaRadio3"><img src="../../static/lapida_app/menu/images/candle2.png" alt="" width="60"></label>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div> {% endcomment %}

<div id="checkout" class="checkout">
    <div class="card shadow border-0 mb-5">

          <!-- Card -->
          <div class="card-body p-5">
              <h2 class="h4 mb-1">Payment Summary</h2>
              <ul class="list-group list-group-flush">
                <div id="gravesiteheader">
                    <li class='list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0'>Gravesite Care</li>
                </div>
                <div id="gravestoneprice">
                    <li class='list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0 tab'>Gravestone Care<span>₱1000.00</span></li>
                </div>
                <div id="landscapeprice">
                    <li class='list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0 tab'>Landscape Care<span>₱1000.00</span></li>
                </div>
                <div id="flowersection">
                    <div id="floralheader">
                        <li class='list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0'>Floral Arrangements</li>
                    </div>
                    {%for flower_summary in flowers_summary%}
                    {{flower_summary|safe}}
                   {%endfor -%}
                </div>
                <!-- <div id="candleprice">
                <li class='list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0'>Candle Lights<span>₱500.00</span></li>
                </div> -->
                <div id="prayerprice">
                <li class='list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0'>Prayer Service<span>₱1500.00</span></li>
                </div>
                <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 mb-3">
                  <div>
                    <strong>Total amount</strong>
                  </div>
                    <div class="totalpay" id="totalpay" name="totalpay">

                    </div>
                </li>
              </ul>
              <button type="Submit" class="btn btn-primary btn-block">Proceed to Checkout</button>
              <input type="hidden" value="" id="cat_id" name="cat_id" />
              <input type="hidden" value="" id="summary" name="summary" />
              </form>
            </div>
          </div>
    </div>
            </div>
        </div>
    </div>
</div>
</section>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
    <script src="{% static 'lapida_app/menu/js/gijgo.min.js' %}" charset="utf-8"></script>
    <script src="{% static 'lapida_app/menu/spinner/src/input-spinner.js' %}"></script>

    <script type="text/javascript">

$(document).ready(function(){

$('input[type=number]').inputSpinner();

$('#datepicker').datepicker();
var old_flower = ""
// Checkbox interactions

$('#gravecard').hide();
$('#flowercard').hide();
$('#datepickercard').hide();
$('#notecard').hide();
$('#gravesiteheader, #floralheader, #citiforagroup, #gertudesgroup, #raphaelgroup, #larosegroup, #arrangementtext, #gravestoneprice, #landscapeprice, #candleprice, #prayerprice').hide();
$('#citiforaprice1, #citiforaprice2, #citiforaprice3, #citiforaprice4, #gertudesprice1, #gertudesprice2, #gertudesprice3, #gertudesprice4, #gertudesprice5, #raphaelprice1, #raphaelprice2, #raphaelprice3, #laroseprice1, #laroseprice2').hide();

$('#candleCheck, #prayerCheck').change(function(){
if($('#graveCheck, #flowerCheck, #candleCheck, #prayerCheck').is(':checked')){
$('#datepickercard').fadeIn('slow');
$('#notecard').fadeIn('slow');
$('#checkout').fadeIn('slow');
}
else{
$('#datepickercard').fadeOut('slow');
$('#notecard').fadeOut('slow');
$('#checkout').fadeOut('slow');
}
});
$('#graveCheck').change(function(){
if($('#graveCheck').is(':checked')){
$('#gravecareCheck').prop('checked', true);
$('#landscapeCheck').prop('checked', true);
$('#gravecard').fadeIn('slow');
$('#datepickercard').fadeIn('slow');
$('#notecard').fadeIn('slow');
$('#checkout').fadeIn('slow');
}
else if($('#flowerCheck, #candleCheck, #prayerCheck').is(':checked'))
$('#gravecard').fadeOut('slow');
else{
$('#gravecard').fadeOut('slow');
$('#flowercard').fadeOut('slow');
$('#datepickercard').fadeOut('slow');
$('#notecard').fadeOut('slow');
$('#checkout').fadeOut('slow');
}
});

$('#flowerCheck').change(function(){
if($('#flowerCheck').is(':checked')){
$('#flowercard').fadeIn('slow');
}
else if($('#graveCheck, #candleCheck, #prayerCheck').is(':checked'))
$('#flowercard').fadeOut('slow');
else{
$('#gravecard').fadeOut('slow');
$('#flowercard').fadeOut('slow');
$('#datepickercard').fadeOut('slow');
$('#notecard').fadeOut('slow');
$('#checkout').fadeOut('slow');
}
});
// Dynamic Payment Display Behavior
$('#gravecareCheck').change(function(){
    compute_finalpay()
    if($('#gravecareCheck').is(':checked')){
        $('#gravesiteheader').fadeIn('slow');
        $('#gravestoneprice').fadeIn('slow');
    }
    else{
        if(!$('#landscapeCheck').is(':checked')){
            $('#gravesiteheader').fadeOut('slow');
            $('#gravecard').fadeOut('slow');
            $('#flowercard').fadeOut('slow');
            $('#datepickercard').fadeOut('slow');
            $('#notecard').fadeOut('slow');
            $('#checkout').fadeOut('slow');
            $('#graveCheck').prop('checked', false);
        }
        $('#gravestoneprice').fadeOut('slow');
    }
});

$('#landscapeCheck').change(function(){
    compute_finalpay()
    if($('#landscapeCheck').is(':checked')){
        $('#gravesiteheader').fadeIn('slow');
        $('#landscapeprice').fadeIn('slow');
    }
    else{
        if(!$('#gravecareCheck').is(':checked')){
            $('#gravesiteheader').fadeOut('slow');
            $('#gravecard').fadeOut('slow');
            $('#flowercard').fadeOut('slow');
            $('#datepickercard').fadeOut('slow');
            $('#notecard').fadeOut('slow');
            $('#checkout').fadeOut('slow');
            $('#graveCheck').prop('checked', false);
        }
        $('#landscapeprice').fadeOut('slow');
    }
});

$('#graveCheck').change(function(){
    compute_finalpay()
    if($('#graveCheck').is(':checked')){
        if($('#gravecareCheck').is(':checked')){
            $('#gravesiteheader').fadeIn('slow');
            $('#gravestoneprice').fadeIn('slow');
           
            
        }
        if($('#landscapeCheck').is(':checked')){
            $('#gravesiteheader').fadeIn('slow');
            $('#landscapeprice').fadeIn('slow');
           
            
        }
    }
    else{
        if($('#gravecareCheck').is(':checked')){
            $('#gravesiteheader').fadeOut('slow');
            $('#gravestoneprice').fadeOut('slow');
           
            
        }
        if($('#landscapeCheck').is(':checked')){
            $('#gravesiteheader').fadeOut('slow');
            $('#landscapeprice').fadeOut('slow');
           
            
        }
    }
    
});

// Flower Select Change
$('#flowerSelect').change(function(){
    compute_finalpay()
    $('#floralheader').fadeIn('slow');
    $('#datepickercard').fadeIn('slow');
    $('#notecard').fadeIn('slow');
    $('#checkout').fadeIn('slow');
    $('#flowersection').fadeIn('slow');
    if(this.value == "citifora"){
        $('#citiforagroup').fadeIn('slow');
        $('#gertudesgroup').hide();
        $('#raphaelgroup').hide();
        $('#larosegroup').hide();
        update_flowers()
    }
    else if(this.value == "gertudes"){
        $('#gertudesgroup').fadeIn('slow');
        $('#citiforagroup').hide();
        $('#raphaelgroup').hide();
        $('#larosegroup').hide();
        update_flowers()
    }
    else if(this.value == "raphael"){
        $('#raphaelgroup').fadeIn('slow');
        $('#citiforagroup').hide();
        $('#gertudesgroup').hide();
        $('#larosegroup').hide();
        $('#notecard').fadeIn('slow');
        $('#checkout').fadeIn('slow');
        update_flowers()
    }
    else if(this.value == "larose"){
        $('#citiforaprice1, #citiforaprice2, #citiforaprice3, #citiforaprice4, #gertudesprice1, #gertudesprice2, #gertudesprice3, #gertudesprice4, #gertudesprice5, #raphaelprice1, #raphaelprice2, #raphaelprice3, #laroseprice1, #laroseprice2').hide();
        $('#larosegroup').fadeIn('slow');
        $('#citiforagroup').hide();
        $('#gertudesgroup').hide();
        $('#raphaelgroup').hide();
        update_flowers()
    }
});

$("input[type='radio'][name='citifora']").change(function(){
    update_flowers()
    compute_finalpay()
})
$("input[type='radio'][name='gertudes']").change(function(){
    update_flowers()
    compute_finalpay()
})
$("input[type='radio'][name='raphael']").change(function(){
    update_flowers()
    compute_finalpay()
})
$("input[type='radio'][name='larose']").change(function(){
    update_flowers()
    compute_finalpay()
})


$('#flowerCheck').change(function(){
    compute_finalpay()
    if($('#flowerCheck').is(':checked')){
        $('#flowersection').fadeIn('slow');
        if($("select[name='flowerSelect']").val()){
            $('#floralheader').fadeIn('slow');
            $('#datepickercard').fadeIn('slow');
            $('#notecard').fadeIn('slow');
            $('#checkout').fadeIn('slow');
            $('#flowersection').fadeIn('slow');
        }
        update_flowers()
    }
    else{        
        old_flower = ""
        $('#flowersection').hide();
    }
});

$('#candleCheck').change(function(){
    if($('#candleCheck').is(':checked')){
        $('#candleprice').fadeIn('slow');
    }
    else{
        $('#candleprice').fadeOut('slow');
    }
    
});

$('#prayerCheck').change(function(){
    compute_finalpay()
    if($('#prayerCheck').is(':checked')){
        $('#prayerprice').fadeIn('slow');
    }
    else{
        $('#prayerprice').fadeOut('slow');
    }
});

function update_flowers(){
    // Checking for flowers
    if($('#flowerCheck').is(':checked') && $("select[name='flowerSelect']").val()){
        var abbrev_flower_shop = $("select[name='flowerSelect']").val()
        var input_selector = `input[name='${abbrev_flower_shop}']:checked`
        flower_shop_sumary = $(input_selector).attr("id") + "_summary"
        if (old_flower){
            var old_flower_summary = old_flower + "_summary"
            $(`#${old_flower_summary}`).attr("hidden",true);
        }
        $(`#${flower_shop_sumary}`).attr("hidden",false);
        old_flower = $(input_selector).attr("id")
    }
}
});

function compute_finalpay(){
    // Checking for gravesite Care
    var new_finalpay = 0
    if($('#graveCheck').is(':checked')){
    if($('#landscapeCheck').is(':checked')){
        new_finalpay = new_finalpay + parseInt($("input[name='landscapeCheck']:checked").attr("graveprice"))
    }
    if($('#gravecareCheck').is(':checked')){
        new_finalpay = new_finalpay + parseInt($("input[name='gravecareCheck']:checked").attr("graveprice"))
    }
    }
    // Checking for flowers
    if($('#flowerCheck').is(':checked') && $("select[name='flowerSelect']").val()){
        var abbrev_flower_shop = $("select[name='flowerSelect']").val()
        var input_selector = `input[name='${abbrev_flower_shop}']:checked`
        new_finalpay = new_finalpay + parseInt($(input_selector).attr("flower_price"))
    }
    if($('#prayerCheck').is(':checked')){
        new_finalpay = new_finalpay + parseInt($("input[name='prayerCheck']:checked").attr("prayerPrice"))
    }
    $("#totalpay").empty();
    $( ".totalpay" ).append( "<span><strong>₱" + new_finalpay + ".00</strong></span>" );
    $("#cat_id").val(new_finalpay);
}
    </script>
{%endblock%}